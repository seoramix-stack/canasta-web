<!DOCTYPE html>
<html lang="en">

<head>
    <link rel="manifest" href="manifest.json">

    <link rel="apple-touch-icon" href="icon-192.png">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#1a252f">

    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js')
                    .then(reg => console.log('PWA Service Worker Registered'))
                    .catch(err => console.log('PWA Error:', err));
            });
        }
    </script>
    <meta charset="UTF-8">
    <title>Canasta Master Club | Online Multiplayer & Rated ELO Play</title>

    <meta name="description"
        content="Play classic Canasta online with 2 or 4 players. Features rated ELO matchmaking, 12-minute match banks, and 1-minute turn timers. Choose between Standard (Draw 2) or Easy rules.">
    <meta name="keywords"
        content="Canasta online, multiplayer Canasta, Canasta ELO ranking, play Canasta with bots, Canasta rules 2 players">

    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <meta property="og:title" content="Canasta Master Club">
    <meta property="og:description"
        content="Compete in rated Canasta matches. Standard Draw 2 or Easy Draw 1 rules available.">
    <meta property="og:image" content="Canasta logo.png">
    <meta property="og:type" content="website">

    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Canasta Master Club">
    <meta name="twitter:description"
        content="Authentic multiplayer Canasta with professional ELO rankings and bot training.">
    <meta name="twitter:image" content="Canasta logo.png">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Cinzel+Decorative:wght@900&family=Cinzel:wght@400;700;900&family=Roboto:wght@400;500;700&display=swap"
        rel="stylesheet">

    <link rel="stylesheet" href="style.css">
    <style>
        /* Spinner Animation (Preserved from original) */
        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }
    </style>
    <script type="application/ld+json">
[{
  "@context": "https://schema.org",
  "@type": "HowTo",
  "name": "How to Play Canasta Master Club",
  "description": "Learn the official rules for Standard and Easy Canasta modes, including ELO ranking and match timers.",
  "step": [
    {
      "@type": "HowToStep",
      "name": "Choose your Ruleset",
      "text": "Select Standard for a 2-card draw and 2-Canasta requirement, or Easy for a 1-card draw and 1-Canasta requirement."
    },
    {
      "@type": "HowToStep",
      "name": "Understand the Timers",
      "text": "Manage your 12-minute match bank and 60-second turn limit to avoid automatic forfeit."
    },
    {
      "@type": "HowToStep",
      "name": "Master the ELO System",
      "text": "Win matches to increase your rating. Points gained are scaled based on your opponent's skill and your margin of victory."
    }
  ]
},
{
  "@context": "https://schema.org",
  "@type": "HowTo",
  "name": "How to Create a Private Canasta Room",
  "description": "Invite friends to a private rated or unrated Canasta match.",
  "step": [
    {
      "@type": "HowToStep",
      "name": "Generate Room ID",
      "text": "Click 'Play with Friends' to generate a unique 6-digit room code."
    },
    {
      "@type": "HowToStep",
      "name": "Share Code",
      "text": "Send the code to your friends. They can join by entering the ID in the 'Join Room' field."
    }
  ]
}]
</script>
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "VideoGame",
      "name": "Canasta Master Club",
      "description": "Rated multiplayer Canasta with customizable rules (Draw 1 or 2) and competitive ELO systems.",
      "genre": ["Card Game", "Strategy Game"],
      "gamePlatform": ["Web Browser"],
      "featureList": [
        "12-minute match bank timers",
        "1-minute turn timers to prevent AFK",
        "2-Player and 4-Player modes",
        "ELO Rating system with margin-of-victory scaling"
      ]
    }
    </script>
    <script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "Table",
  "about": "Canasta Card Point Values",
  "mainEntity": [
    {"name": "Joker", "value": "50 points"},
    {"name": "Ace", "value": "20 points"},
    {"name": "Natural Canasta", "value": "500 points"},
    {"name": "Mixed Canasta", "value": "300 points"}
  ]
}
</script>
</head>

<body>
    <div id="screen-landing" class="app-screen">
        <div class="landing-content">
            <div class="logo-area">
                <img src="Canasta logo.png" class="landing-hero-logo">
                <h1 class="logo">CANASTA</h1>
                <h2 class="logo">MASTER CLUB</h2>

                <div class="feature-pills">
                    <span>üèÜ RATED ELO</span>
                    <span>‚è±Ô∏è DUAL TIMERS</span>
                    <span>üÉè 2/4 PLAYER</span>
                </div>
            </div>

            <div class="landing-action-grid">
                <div class="landing-cta">
                    <button class="menu-btn primary" onclick="navTo('screen-login')">GET STARTED</button>
                    <button class="menu-btn secondary" onclick="navTo('screen-how-to')">LEARN TO PLAY</button>
                    <button onclick="installApp()">üì≤ INSTALL APP</button>
                </div>

                <div class="landing-stats-preview">
                    <h3>üåç TOP MASTERS</h3>
                    <div id="landing-leaderboard-list" class="leaderboard-mini">
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div id="screen-login" class="app-screen">
        <div class="screen-header">
            <div class="back-nav" onclick="navTo('screen-landing')">
                <span class="back-text" style="font-size: 16px; text-decoration: none;">&lt; BACK</span>
            </div>
        </div>
        <div class="logo-area">
            <img src="Canasta logo.png" style="width: 150px; height: auto; margin-bottom: 20px;">
            <h1 class="logo">CANASTA</h1>
            <h2 class="logo">MASTER CLUB</h2>
        </div>

        <div id="form-login" style="display:flex; flex-direction:column; align-items:center; width:100%;">
            <div class="error-msg" id="login-error">Invalid credentials</div>

            <div class="form-group">
                <input type="text" id="login-user" class="form-input" placeholder="Username">
            </div>

            <div class="form-group" style="position: relative;">
                <input type="password" id="login-pass" class="form-input" placeholder="Password">
                <span class="pass-toggle" onclick="togglePass('login-pass', this)">üëÅÔ∏è</span>
            </div>

            <button class="menu-btn primary" onclick="doLogin()">LOGIN</button>
            <button class="menu-btn secondary" style="margin-top: 10px;" onclick="navTo('screen-how-to')">RULES</button>
            <div class="link-text" onclick="toggleForms('register')">Create an Account</div>
        </div>

        <div id="form-register" style="display:none; flex-direction:column; align-items:center; width:100%;">
            <div class="error-msg" id="reg-error">Username taken</div>

            <div class="form-group">
                <input type="text" id="reg-user" class="form-input" placeholder="Choose Username">
            </div>

            <div class="form-group" style="position: relative;">
                <input type="password" id="reg-pass" class="form-input" placeholder="Choose Password">
                <span class="pass-toggle" onclick="togglePass('reg-pass', this)">üëÅÔ∏è</span>
            </div>

            <button class="menu-btn success" onclick="doRegister()">CREATE ACCOUNT</button>
            <div class="link-text" onclick="toggleForms('login')">Back to Login</div>
        </div>
    </div>
    <div id="screen-home" class="app-screen">

        <div class="logo-area">
            <img src="Canasta logo.png" class="landing-hero-logo" style="width: 180px; margin-bottom: 10px;">
            <h1 class="logo">CANASTA</h1>
            <h2 class="logo">MASTER CLUB</h2>
        </div>

        <div class="menu-list">
            <button class="menu-btn primary" onclick="navTo('screen-online')"><span></span> PLAY ONLINE</button>
            <button class="menu-btn" onclick="navTo('screen-bot')"><span></span> TRAIN VS BOTS</button>

            <button class="menu-btn secondary" onclick="openFriendsScreen()"><span></span> FRIENDS</button>
            <button class="menu-btn secondary" onclick="openProfile()"><span></span> MY PROFILE</button>
            <button class="menu-btn" onclick="navTo('screen-how-to')"><span></span>RULES</button>
            <!-- REPLACED MEMBERSHIP WITH LEADERBOARD FOR LAUNCH -->
            <!-- <button class="menu-btn primary" onclick="openSubscribeScreen()" style="background: linear-gradient(135deg, #9b59b6, #8e44ad) !important; box-shadow: 0 0 15px rgba(155, 89, 182, 0.4); border: none;">MEMBERSHIP</button> -->
            <button class="menu-btn primary" onclick="navTo('screen-leaderboard')"
                style="background: linear-gradient(135deg, #f1c40f, #f39c12) !important; border: none; color: #2c3e50;">LEADERBOARD</button>
            </button>
        </div>
    </div>

    <div id="screen-bot" class="app-screen">
        <h2>VS BOTS</h2>
        <div class="info-text">Practice match</div>

        <div style="margin-bottom: 10px; color: #bdc3c7; font-size: 14px; margin-top: 10px;">PLAYERS</div>
        <div class="diff-grid">
            <button class="diff-btn p-count-btn" onclick="selectPlayerCount(2, this)">2 PLAYERS</button>
            <button class="diff-btn p-count-btn selected" onclick="selectPlayerCount(4, this)">4 PLAYERS</button>
        </div>

        <div style="margin-bottom: 10px; color: #bdc3c7; font-size: 14px; margin-top: 15px;">RULES</div>
        <div class="diff-grid">
            <button class="diff-btn rules-btn selected" onclick="selectRuleset('standard', this)"
                style="font-size: 12px; padding: 10px;">
                DRAW 2<br>2 OUT
            </button>
            <button class="diff-btn rules-btn" onclick="selectRuleset('easy', this)"
                style="font-size: 12px; padding: 10px;">
                DRAW 1<br>1 OUT
            </button>
        </div>
        <button class="menu-btn primary" onclick="connectToGame('bot')" style="margin-top: 20px;">START MATCH</button>
        <button class="menu-btn text-only" onclick="navTo('screen-home')">BACK</button>
    </div>

    <div id="screen-profile" class="app-screen">
        <div class="screen-header">
            <h2>MY PROFILE</h2>
        </div>

        <div style="position: relative; margin-bottom: 10px; display: inline-block;">

            <div style="font-size: 60px;">üë§</div>

            <div id="premium-badge"
                style="display:none; position: absolute; bottom: -5px; right: -10px; background: #f1c40f; color: #2c3e50; font-size: 10px; font-weight: bold; padding: 2px 6px; border-radius: 6px; border: 2px solid #2c3e50; box-shadow: 0 2px 5px rgba(0,0,0,0.5); z-index: 5;">
                PREMIUM
            </div>

        </div>
        <div id="my-username" class="p-name"
            style="font-size: 24px; font-weight: bold; color: #f1c40f; margin-bottom: 20px;">Player</div>
        <button id="btn-manage-sub" class="menu-btn secondary" onclick="manageSubscription()"
            style="display:none; margin-bottom: 10px; border-color: #9b59b6; color: #9b59b6;">
            MANAGE SUBSCRIPTION
        </button>
        <div style="display: flex; gap: 20px; margin-bottom: 30px;">
            <div style="text-align: center;">
                <div style="font-size: 12px; color: #bdc3c7;">RATING</div>
                <div id="my-rating" style="font-size: 20px;">---</div>
            </div>
            <div style="text-align: center;">
                <div style="font-size: 12px; color: #bdc3c7;">WINS</div>
                <div id="my-wins" style="font-size: 20px;">---</div>
            </div>
            <div style="text-align: center;">
                <div style="font-size: 12px; color: #bdc3c7;">LOSSES</div>
                <div id="my-losses" style="font-size: 20px;">---</div>
            </div>
        </div>

        <button class="menu-btn danger" onclick="logout()">LOGOUT</button>
        <button class="menu-btn text-only" onclick="navTo('screen-home')">BACK</button>
    </div>

    <div id="screen-queue" class="app-screen">
        <h2>SEARCHING...</h2>
        <div class="info-text" id="queue-msg">Connecting to server...</div>

        <div
            style="margin: 30px 0; width: 50px; height: 50px; border: 5px solid #333; border-top: 5px solid #3498db; border-radius: 50%; animation: spin 1s linear infinite;">
        </div>

        <button class="menu-btn danger" onclick="leaveGame()">CANCEL</button>
    </div>

    <div id="screen-online" class="app-screen">
        <h2>PLAY ONLINE</h2>

        <div style="margin-bottom: 15px;">

            <button class="menu-btn secondary" onclick="openLeaderboard()" style="margin-bottom: 20px;">
                üèÜ TOP 10 LEADERBOARD
            </button>
            <div class="diff-grid">
                <button class="menu-btn secondary" onclick="connectToGame('casual')" style="display:none;">‚ö° QUICK
                    MATCH</button>
                <button class="diff-btn p-count-btn selected" onclick="selectPlayerCount(4, this)">4 PLAYERS</button>
            </div>
        </div>

        <button class="menu-btn primary" onclick="connectToGame('rated')">üèÜ FIND MATCH</button>
        <div class="info-text">Ranked matches. Auto-match.</div>

        <hr style="width: 50%; border-color: #555; margin: 15px 0;">

        <div style="color: #bdc3c7; margin-bottom:10px;">CASUAL</div>

        <button class="menu-btn secondary" onclick="connectToGame('casual')" style="display:none;">‚ö° QUICK
            MATCH</button>
        <button class="menu-btn secondary" onclick="navTo('screen-private-menu')">üîí PRIVATE ROOM</button>

        <br>
        <button class="menu-btn text-only" onclick="navTo('screen-home')">BACK</button>
    </div>

    <div id="screen-private-menu" class="app-screen">
        <h2>PRIVATE ROOM</h2>
        <p>Play with friends</p>

        <button class="menu-btn primary" onclick="navTo('screen-create-room')">CREATE ROOM</button>
        <button class="menu-btn secondary" onclick="navTo('screen-join-room')">JOIN ROOM</button>
        <br>
        <button class="menu-btn text-only" onclick="navTo('screen-online')">BACK</button>
    </div>

    <div id="screen-create-room" class="app-screen">
        <h2>CREATE ROOM</h2>
        <p>Name your room</p>

        <div class="form-group">
            <input type="text" id="create-room-name" class="form-input" placeholder="Room Name (e.g. 'table1')"
                maxlength="12">
        </div>

        <div style="margin: 15px 0;">
            <div style="color: #bdc3c7; font-size: 14px; margin-bottom: 5px;">MAX PLAYERS</div>
            <div class="diff-grid">
                <button class="diff-btn p-count-btn" onclick="selectPlayerCount(2, this)">2 PLAYERS</button>
                <button class="diff-btn p-count-btn selected" onclick="selectPlayerCount(4, this)">4 PLAYERS</button>
            </div>
        </div>
        <div style="margin: 15px 0;">
            <div style="color: #bdc3c7; font-size: 14px; margin-bottom: 5px;">GAME RULES</div>
            <div class="diff-grid">
                <button class="diff-btn rules-btn selected" onclick="selectRuleset('standard', this)"
                    style="font-size: 12px; padding: 10px;">
                    DRAW 2<br>2 OUT
                </button>
                <button class="diff-btn rules-btn" onclick="selectRuleset('easy', this)"
                    style="font-size: 12px; padding: 10px;">
                    DRAW 1<br>1 OUT
                </button>
            </div>
        </div>
        <br>
        <button class="menu-btn success" onclick="doCreateRoom()">CREATE & JOIN</button>
        <button class="menu-btn text-only" onclick="navTo('screen-private-menu')">CANCEL</button>
    </div>

    <div id="screen-join-room" class="app-screen">
        <h2>JOIN ROOM</h2>
        <div class="form-group">
            <input type="text" id="join-id" class="form-input" placeholder="Room ID (e.g. game_xyz)">
        </div>
        <button class="menu-btn primary" onclick="doJoinPrivate()">ENTER ROOM</button>
        <button class="menu-btn text-only" onclick="navTo('screen-private-menu')">CANCEL</button>
    </div>

    <div id="screen-friends" class="app-screen">
        <div class="screen-header">
            <h2>FRIENDS & PLAYERS</h2>
        </div>

        <div style="display:flex; gap:10px; margin-bottom:15px;">
            <button class="action-btn" onclick="showFriendTab('list')">MY FRIENDS</button>
            <button class="action-btn secondary" onclick="showFriendTab('search')">SEARCH</button>
            <button class="action-btn danger" onclick="showFriendTab('blocked')">BLOCKED</button>
        </div>

        <div id="friend-content"
            style="width: 90%; max-width: 400px; background: rgba(0,0,0,0.2); height: 300px; overflow-y: auto; border-radius: 8px; padding: 10px;">
            <div style="text-align:center; color:#aaa; margin-top:50px;">Loading...</div>
        </div>

        <div id="friend-search-bar" style="display:none; width: 90%; margin-top: 10px;">
            <input type="text" id="search-query" class="form-input" placeholder="Type username..."
                onkeyup="doUserSearch()">
        </div>

        <br>
        <button class="menu-btn text-only" onclick="navTo('screen-home')">BACK</button>
    </div>

    <div id="screen-lobby" class="app-screen">
        <h2>LOBBY</h2>
        <div style="background:#2ecc71; color:white; padding:5px 10px; border-radius:5px; margin-bottom:10px;">
            ROOM ID: <span id="lobby-room-id" style="font-weight:bold;">---</span>
        </div>

        <div id="lobby-players" style="margin: 20px 0; width: 100%;">
        </div>

        <div id="lobby-host-controls" style="display:none;">
            <button class="menu-btn success" onclick="sendReady()">START MATCH</button>
        </div>
        <div id="lobby-wait-msg" style="color:#f1c40f;">Waiting for host...</div>

        <button class="menu-btn danger" onclick="leaveGame()">LEAVE LOBBY</button>
    </div>

    <div id="screen-victory" class="app-screen">
        <div class="victory-content">
            <h1 id="vic-title">VICTORY!</h1>
            <p id="vic-sub">TEAM 1 WINS THE MATCH</p>

            <div class="score-box"
                style="background: rgba(0,0,0,0.4); border: 1px solid rgba(255,255,255,0.2); width: 100%; max-width: 500px; margin: 0 auto 20px auto;">
                <table class="score-table" style="color: white; margin: 0;">
                    <thead>
                        <tr>
                            <th style="background: rgba(241, 196, 15, 0.2); color: #f1c40f;">Category</th>
                            <th id="vic-header-1" style="background: rgba(241, 196, 15, 0.2); color: #f1c40f;">Team 1
                            </th>
                            <th id="vic-header-2" style="background: rgba(241, 196, 15, 0.2); color: #f1c40f;">Team 2
                            </th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Base Points</td>
                            <td id="vic-base-1">0</td>
                            <td id="vic-base-2">0</td>
                        </tr>
                        <tr>
                            <td>Red 3s</td>
                            <td id="vic-red3-1">0</td>
                            <td id="vic-red3-2">0</td>
                        </tr>
                        <tr>
                            <td>Canastas</td>
                            <td id="vic-canasta-1">0</td>
                            <td id="vic-canasta-2">0</td>
                        </tr>
                        <tr>
                            <td>Go Out Bonus</td>
                            <td id="vic-bonus-1">0</td>
                            <td id="vic-bonus-2">0</td>
                        </tr>
                        <tr>
                            <td>Deductions</td>
                            <td id="vic-deduct-1">0</td>
                            <td id="vic-deduct-2">0</td>
                        </tr>
                        <tr style="border-top: 1px solid #555;">
                            <td>Round Total</td>
                            <td id="vic-round-1">0</td>
                            <td id="vic-round-2">0</td>
                        </tr>
                        <tr style="color: #bdc3c7; font-size: 13px; background: rgba(255,255,255,0.05);">
                            <td>+ Previous Score</td>
                            <td id="vic-prev-1">0</td>
                            <td id="vic-prev-2">0</td>
                        </tr>
                        <tr class="total-row" style="background: #f1c40f; color: #2c3e50; font-size: 18px;">
                            <td>FINAL SCORE</td>
                            <td id="vic-total-1">0</td>
                            <td id="vic-total-2">0</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <div id="victory-ratings"
                style="margin-bottom: 20px; width: 280px; margin: 0 auto 20px auto; background: rgba(0,0,0,0.3); padding: 10px; border-radius: 8px; display:none;">
            </div>

            <button id="btn-victory-start" class="menu-btn primary" onclick="connectToGame('bot')">START NEW
                MATCH</button>
            <button class="menu-btn secondary" onclick="navTo('screen-home')">BACK TO MENU</button>
        </div>
    </div>
    <div id="screen-game" class="app-screen game-bg">
        <div id="status" class="game-status">Connecting...</div>
        <div id="queue-modal"
            style="display:none; position:absolute; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.9); z-index:2000; flex-direction:column; align-items:center; justify-content:center;">
            <div class="ready-box">
                <div class="ready-title" style="color:#3498db">SEARCHING...</div>
                <div class="ready-sub" style="margin:10px 0;">Looking for opponents...</div>

                <div style="display:flex; gap:15px; margin-bottom:20px;">
                    <div class="p-indicator" id="q-ind-0">1</div>
                    <div class="p-indicator" id="q-ind-1">2</div>
                    <div class="p-indicator" id="q-ind-2">3</div>
                    <div class="p-indicator" id="q-ind-3">4</div>
                </div>

                <div
                    style="width: 30px; height: 30px; border: 4px solid #444; border-top: 4px solid #3498db; border-radius: 50%; animation: spin 1s linear infinite;">
                </div>
                <button class="menu-btn text-only" onclick="leaveGame()" style="margin-top:20px;">CANCEL</button>
            </div>
        </div>

        <div id="ready-modal">
            <div class="ready-box">
                <div id="ready-step-1">
                    <div class="ready-title">GAME FOUND!</div>
                    <div class="ready-sub">Are you ready to start?</div>
                    <button class="action-btn success" onclick="sendReady()">START GAME</button>
                </div>

                <div id="ready-step-2" style="display:none; flex-direction:column; align-items:center;">
                    <div class="ready-title" style="color:#bdc3c7">WAITING...</div>
                    <div class="ready-sub" style="margin:10px 0;">Waiting for other players...</div>

                    <div id="ready-indicators" style="display:flex; gap:15px; margin-bottom:20px;">
                        <div class="p-indicator" id="ind-0">P1</div>
                        <div class="p-indicator" id="ind-1">P2</div>
                        <div class="p-indicator" id="ind-2">P3</div>
                        <div class="p-indicator" id="ind-3">P4</div>
                    </div>

                    <div
                        style="width: 30px; height: 30px; border: 4px solid #444; border-top: 4px solid #f1c40f; border-radius: 50%; animation: spin 1s linear infinite;">
                    </div>
                </div>
            </div>
        </div>

        <div id="score-modal" style="display: none;">
            <div class="score-box">
                <h2>üèÜ ROUND OVER üèÜ</h2>

                <table class="score-table">
                    <thead>
                        <tr>
                            <th>Category</th>
                            <th id="header-col-1">Team 1</th>
                            <th id="header-col-2">Team 2</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Base Points</td>
                            <td id="row-base-1">0</td>
                            <td id="row-base-2">0</td>
                        </tr>
                        <tr>
                            <td>Red 3s</td>
                            <td id="row-red3-1">0</td>
                            <td id="row-red3-2">0</td>
                        </tr>
                        <tr>
                            <td>Canastas</td>
                            <td id="row-canasta-1">0</td>
                            <td id="row-canasta-2">0</td>
                        </tr>
                        <tr>
                            <td>Go Out Bonus</td>
                            <td id="row-bonus-1">0</td>
                            <td id="row-bonus-2">0</td>
                        </tr>
                        <tr>
                            <td>Deductions</td>
                            <td id="row-deduct-1">0</td>
                            <td id="row-deduct-2">0</td>
                        </tr>
                        <td>ROUND TOTAL</td>
                        <td id="row-total-1">0</td>
                        <td id="row-total-2">0</td>
                        </tr>
                        <tr style="color: #7f8c8d; font-size: 13px; background: #f9f9f9;">
                            <td>+ Previous Score</td>
                            <td id="row-prev-1">0</td>
                            <td id="row-prev-2">0</td>
                        </tr>
                        <tr class="total-row" style="background: #e1e1e1; border-top: 2px solid #bdc3c7;">
                            <td>TOTAL SCORE</td>
                            <td id="row-cumul-1">0</td>
                            <td id="row-cumul-2">0</td>
                        </tr>
                    </tbody>
                </table>

                <button class="action-btn success" onclick="startNextRound()" style="margin-top:20px; width:100%;">START
                    NEXT ROUND</button>
                <button class="action-btn danger" onclick="leaveGame()" style="margin-top:10px; width:100%;">LEAVE
                    GAME</button>
            </div>
        </div>



        <div id="staging-panel">
            <div class="staging-header">
                <span>STAGED: <span id="staged-pts">0</span> / <span id="req-pts">0</span></span>
                <button class="close-btn" onclick="cancelOpening()">X</button>
            </div>
            <div id="staged-container"></div>
            <button id="btn-confirm-open" onclick="sendOpening()" class="action-btn success full-width"
                disabled>CONFIRM</button>
        </div>

        <div id="game-ui">
            <div id="btn-game-menu" onclick="toggleGameMenu()">‚ò∞</div>

            <div id="game-menu-overlay" style="display: none;">
                <div class="menu-box">
                    <h3>PAUSED</h3>
                    <button class="menu-btn secondary" onclick="askToGoOut()" style="margin-bottom:10px;">ASK TO GO
                        OUT</button>
                    <button class="menu-btn primary" onclick="toggleGameMenu()">RESUME</button>
                    <button class="menu-btn danger" onclick="confirmLeave()">LEAVE GAME</button>
                </div>
            </div>
            <div id="game-grid">

                <div id="partner-zone">
                    <div id="hand-partner" class="horiz-hand-container"></div>
                </div>

                <div id="timers-top" class="timer-row"></div>

                <div id="hud-left" class="player-hud">
                    <div class="status-light" id="light-left"></div>
                    <div class="hud-name" id="name-left">P4</div>
                    <div class="timer-text" id="timer-left">12:00</div>
                </div>

                <div id="hud-partner" class="player-hud">
                    <div class="status-light" id="light-partner"></div>
                    <div class="hud-name" id="name-partner">P3</div>
                    <div class="timer-text" id="timer-partner">12:00</div>
                </div>

                <div id="hud-right" class="player-hud">
                    <div class="status-light" id="light-right"></div>
                    <div class="hud-name" id="name-right">P2</div>
                    <div class="timer-text" id="timer-right">12:00</div>
                </div>

                <div id="hand-left-zone" class="side-zone">
                    <div id="hand-left" class="vert-hand-container"></div>
                </div>

                <div id="table-zone">
                    <div id="enemy-melds" class="meld-row"></div>
                    <div class="pile-area">
                        <div class="score-group">
                            <div><span id="lbl-s1">TEAM 1</span>: <span id="live-s1" class="score-val">0</span></div>
                            <div><span id="lbl-s2">TEAM 2</span>: <span id="live-s2" class="score-val">0</span></div>
                        </div>
                        <div class="piles-group">
                            <div id="draw-area" onclick="drawCard()">
                                <img src="cards/BackRed.png" class="card-img">
                                <div id="deck-count">0</div>
                            </div>
                            <div id="discard-area" onclick="handleDiscardClick()">
                                <div id="frozen-underlay"></div>
                                <div id="discard-display"></div>
                            </div>
                        </div>
                    </div>
                    <div id="my-melds" class="meld-row" onclick="meldSelected()"></div>
                </div>

                <div id="hand-right-zone" class="side-zone">
                    <div id="hand-right" class="vert-hand-container"></div>
                </div>

                <div id="timers-bottom" class="timer-row"></div>

                <div id="hud-me" class="player-hud">
                    <div class="status-light" id="light-me"></div>
                    <div class="hud-name" id="name-me">P1</div>
                    <div class="timer-text" id="timer-me">12:00</div>
                </div>

                <div id="my-zone">
                    <div id="my-hand"></div>
                </div>

            </div>
        </div>
    </div>
    <div id="screen-leaderboard" class="app-screen">
        <div class="screen-header">
            <div class="back-nav" onclick="goHome()">
                <span class="home-icon">üè†</span>
                <span class="back-text">LOBBY</span>
            </div>
            <h2>TOP 100 MASTERS</h2>
        </div>
        <div class="info-text" style="margin-bottom: 10px;">Ranked by ELO Rating</div>

        <div id="leaderboard-list" class="leaderboard-container">
            <div style="text-align:center; padding-top:50px;">Loading...</div>
        </div>

        <!-- UPDATED: NAVIGATE TO HOME INSTEAD OF ONLINE MENU -->
        <button class="menu-btn text-only" onclick="navTo('screen-home')">BACK</button>
    </div>
    <div id="modal-partner-ask"
        style="display:none; position:absolute; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.85); z-index:3000; flex-direction:column; align-items:center; justify-content:center;">
        <div
            style="background:#2c3e50; padding:30px; border-radius:10px; border:2px solid #f1c40f; text-align:center; max-width:80%;">
            <div style="font-size:40px; margin-bottom:10px;">üí¨</div>
            <h2 style="color:white; margin:0;">PARTNER ASKS:</h2>
            <h3 style="color:#f1c40f; margin:10px 0 20px 0;">"May I go out?"</h3>

            <div style="display:flex; gap:20px; justify-content:center;">
                <button class="menu-btn success" onclick="replyGoOut(true)" style="width:100px;">YES</button>
                <button class="menu-btn danger" onclick="replyGoOut(false)" style="width:100px;">NO</button>
            </div>
        </div>
    </div>

    <div id="modal-penalty"
        style="display:none; position:absolute; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.8); z-index:3500; align-items:center; justify-content:center;">
        <div
            style="background:#c0392b; color:white; padding:20px; border-radius:8px; text-align:center; border:2px solid white; max-width: 80%;">
            <h2 style="margin:0;">‚õî PENALTY! ‚õî</h2>
            <p id="penalty-msg" style="margin:10px 0; font-size:18px;">Player ignored partner's reply.</p>
            <div style="font-size:24px; font-weight:bold;">-100 POINTS</div>
            <button class="menu-btn text-only" onclick="document.getElementById('modal-penalty').style.display='none'"
                style="color:white; border:1px solid white; margin-top:10px;">OK</button>
        </div>
    </div>
    <div id="screen-how-to" class="app-screen">
        <h1 class="logo">CANASTA RULES & SCORING</h1>

        <div class="rules-container">

            <section class="rules-section">
                <h3>üë• PLAYER MODES</h3>
                <p><strong>Canasta Master Club supports 2 and 4-player competitive matches.</strong></p>
                <ul>
                    <li><strong>2 Players:</strong> Each player is dealt 15 cards and plays individually.</li>
                    <li><strong>4 Players:</strong> Players form two teams of two, dealt 11 cards each.</li>
                </ul>
            </section>

            <section class="rules-section">
                <h3>üìú STANDARD VS. EASY RULES</h3>
                <p><strong>The primary difference between Standard and Easy Canasta is the drawing pace and victory
                        requirements.</strong></p>
                <table class="rules-table">
                    <tr>
                        <th>Feature</th>
                        <th>Standard</th>
                        <th>Easy</th>
                    </tr>
                    <tr>
                        <td>Cards Drawn</td>
                        <td>2 Cards</td>
                        <td>1 Card</td>
                    </tr>
                    <tr>
                        <td>Canastas to Out</td>
                        <td>2 Required</td>
                        <td>1 Required</td>
                    </tr>
                </table>
            </section>

            <section class="rules-section">
                <h3>‚è±Ô∏è DUAL-TIMER SYSTEM</h3>
                <p><strong>Fair play is maintained through a 12-minute match bank and a 60-second turn limit.</strong>
                    If your personal bank reaches 0:00 or you exceed the 1-minute turn limit, you automatically forfeit
                    the match.</p>
            </section>

            <section class="rules-section">
                <h3>CARD POINT GLOSSARY</h3>
                <p><strong>Canasta cards have specific point values used to calculate the final score of a
                        round.</strong></p>
                <table class="rules-table">
                    <tr>
                        <td>Jokers (Wild)</td>
                        <td>50 pts</td>
                    </tr>
                    <tr>
                        <td>Aces & 2s (Wild)</td>
                        <td>20 pts</td>
                    </tr>
                    <tr>
                        <td>8 through King</td>
                        <td>10 pts</td>
                    </tr>
                    <tr>
                        <td>4 through 7</td>
                        <td>5 pts</td>
                    </tr>
                    <tr>
                        <td>Natural Canasta</td>
                        <td>500 pts</td>
                    </tr>
                    <tr>
                        <td>Mixed Canasta</td>
                        <td>300 pts</td>
                    </tr>
                </table>
            </section>

        </div>

        <button id="btn-ready-play" class="menu-btn primary" onclick="navTo('screen-login')">READY TO PLAY?</button>
        <button class="menu-btn text-only" id="back-to-menu-btn" onclick="navTo('screen-home')"
            style="display:none;">BACK TO MENU</button>
    </div>
    <div id="screen-subscribe" class="app-screen">
        <div class="logo-area">
            <h1 class="logo" style="color: #9b59b6; text-shadow: 0 0 15px rgba(155, 89, 182, 0.3);">PREMIUM</h1>
            <h2 class="logo">CLUB ACCESS</h2>
        </div>

        <div class="menu-box" style="max-width: 400px;">
            <h3 style="color: #bdc3c7; border-bottom: 1px solid #555; padding-bottom: 15px;">MEMBER BENEFITS</h3>
            <ul style="text-align: left; color: white; line-height: 2; margin-bottom: 30px; padding-left: 20px;">
                <li>üö´ <b>No Ads</b> between matches</li>
            </ul>

            <div style="font-size: 32px; font-weight: bold; color: white; margin-bottom: 5px;">$2.90</div>
            <div style="color: #bdc3c7; font-size: 14px; margin-bottom: 25px;">per month</div>

            <button class="menu-btn primary" onclick="startStripeCheckout()"
                style="background: linear-gradient(135deg, #9b59b6, #8e44ad) !important;">SUBSCRIBE NOW</button>
            <button class="menu-btn text-only" onclick="navTo('screen-home')">NO THANKS</button>
        </div>
    </div>
    <div id="screen-subscribe-mobile-info" class="app-screen">
        <div class="logo-area">
            <h1 class="logo" style="color: #9b59b6; text-shadow: 0 0 15px rgba(155, 89, 182, 0.3);">PREMIUM</h1>
            <h2 class="logo">CLUB ACCESS</h2>
        </div>

        <div class="menu-box" style="max-width: 400px; text-align: center;">
            <h3 style="color: #bdc3c7; border-bottom: 1px solid #555; padding-bottom: 15px;">HOW TO UPGRADE</h3>

            <p style="color: white; line-height: 1.6; margin: 20px 0;">
                To unlock Premium features like ad-free play, please visit our official website from a web browser.
            </p>

            <p
                style="background: rgba(0,0,0,0.5); padding: 10px; border-radius: 8px; font-weight: bold; color: var(--accent-color);">
                canastamaster.club
            </p>

            <p style="font-size: 12px; color: var(--text-secondary); margin-top: 20px;">
                Once you subscribe on the web, your Premium status will automatically sync to your account here in the
                app.
            </p>

            <button class="menu-btn secondary" onclick="navTo('screen-home')" style="margin-top: 20px;">BACK TO
                MENU</button>
        </div>
    </div>

    <div class="menu-box" style="max-width: 400px;">
        <h3 style="color: #bdc3c7; border-bottom: 1px solid #555; padding-bottom: 15px;">MEMBER BENEFITS</h3>
        <ul style="text-align: left; color: white; line-height: 2; margin-bottom: 30px; padding-left: 20px;">
            <li>üö´ <b>No Ads</b> between matches</li>
        </ul>

        <div style="font-size: 32px; font-weight: bold; color: white; margin-bottom: 5px;">$2.90</div>
        <div style="color: #bdc3c7; font-size: 14px; margin-bottom: 25px;">per month</div>

        <button class="menu-btn primary" onclick="startStripeCheckout()" style="background: linear-gradient(135deg, #9b59b6, #8e44ad) !important;">SUBSCRIBE NOW</button>
        <button class="menu-btn text-only" onclick="navTo('screen-home')">NO THANKS</button>
    </div>
</div>
<div id="screen-subscribe-mobile-info" class="app-screen">
    <div class="logo-area">
        <h1 class="logo" style="color: #9b59b6; text-shadow: 0 0 15px rgba(155, 89, 182, 0.3);">PREMIUM</h1>
        <h2 class="logo">CLUB ACCESS</h2>
    </div>

    <div class="menu-box" style="max-width: 400px; text-align: center;">
        <h3 style="color: #bdc3c7; border-bottom: 1px solid #555; padding-bottom: 15px;">HOW TO UPGRADE</h3>
        
        <p style="color: white; line-height: 1.6; margin: 20px 0;">
            To unlock Premium features like ad-free play, please visit our official website from a web browser.
        </p>

        <p style="background: rgba(0,0,0,0.5); padding: 10px; border-radius: 8px; font-weight: bold; color: var(--accent-color);">
            canastamaster.club
        </p>
        
        <p style="font-size: 12px; color: var(--text-secondary); margin-top: 20px;">
            Once you subscribe on the web, your Premium status will automatically sync to your account here in the app.
        </p>
        
        <button class="menu-btn secondary" onclick="navTo('screen-home')" style="margin-top: 20px;">BACK TO MENU</button>
    </div>
</div>
<script src="https://canastamaster.club/socket.io/socket.io.js"></script>
<script type="module" src="client.js"></script>
</body>

</html>